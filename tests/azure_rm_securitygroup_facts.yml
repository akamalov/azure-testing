- name: Test azure_rm_storageaccount_facts
  hosts: all 
  connection: local
  vars:
      resource_group: Testing
      playbook_debug: yes
  tasks:

    - name: Create a security group 
      azure_rm_securitygroup:
          resource_group: "{{ resource_group }}"
          name: "{{ item }}"
      with_items:
          - test001
          - test002
          - test003 

    - name: Gather facts
      azure_rm_securitygroup_facts:
          resource_group: "{{ resource_group }}"
          name: test001 
      register: output
      
    - debug: var=output
      when: playbook_debug
 
    - assert:
          that: output.results | length == 1

    - name: Gather list 
      azure_rm_securitygroup_facts:
          resource_group: "{{ resource_group }}"
      register: output
      
    - debug: var=output
      when: playbook_debug
 
    - assert:
          that: output.results | length == 3

 
