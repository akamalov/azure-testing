- name: Test azure_rm_resourcegrup
  hosts: all
  connection: local 
  vars:
      playbook_debug: yes
  tasks:
  
    - name: Remove resource group, if it exists
      azure_rm_resourcegroup:
          name: Testing
          state: absent
          debug: "{{ playbook_debug }}"
          log_mode: file 
      register: output

    - debug: var=output
      when: playbook_debug
 
    - name: Create resource group
      azure_rm_resourcegroup:
          name: Testing
          location: westus
          tags:
              testing: testing
              delete: never
      register: output

    - debug: var=output
      when: playbook_debug
  
    - assert:
          that:
              - output.results.tags.testing == 'testing'
              - output.results.tags.delete == 'never'
              - output.results.location == 'westus'

    - name: Attempt to change location
      azure_rm_resourcegroup:
          name: Testing
          location: eastus
          tags:
              testing: testing
              delete: never
      register: output
      ignore_errors: yes

    - debug: var=output
      when: playbook_debug

    - assert:
          that: output.failed

    - name: Should be idempotent
      azure_rm_resourcegroup:
          name: Testing
          location: westus
          tags:
              testing: testing
              delete: never
      register: output
      
    - debug: var=output
      when: playbook_debug
 
    - assert:
          that: not output.changed
