- name: Test azure_rm_storageaccount_facts
  hosts: all 
  connection: local
  vars:
      resource_group: Testing
      playbook_debug: yes
  tasks:

    - name: Create an account
      azure_rm_storageaccount:
          resource_group: "{{ resource_group }}"
          name: "{{ item }}" 
          account_type: Standard_LRS
      with_items:
          - testaccount001
          - testaccount002

    - name: Gather facts
      azure_rm_storageaccount_facts:
          resource_group: "{{ resource_group }}"
          name: testaccount001
      register: output
      
    - debug: var=output
      when: playbook_debug
 
    - assert:
          that: output.results | length == 1

    - name: Gather list 
      azure_rm_storageaccount_facts:
          resource_group: "{{ resource_group }}"
      register: output
      
    - debug: var=output
      when: playbook_debug
 
    - assert:
          that: output.results | length >= 2

 
