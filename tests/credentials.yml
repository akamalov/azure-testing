---
- name: test azure_rm_securitygroup.py
  hosts: localhost
  vars:
     debug_playbook: no
  tasks:
      - name: get credentials from params
        azure_rm_securitygroup:
            subscription_id: "mysubscriptionid"
            client_id: "myclientid"
            client_secret: "myclientsecret"
        register: credentials
     
      - debug: var=credentials['credentials'] 
        when: debug_playbook == True

      - name: get credentials from environment
        azure_rm_securitygroup:
        environment:
            AZURE_SUBSCRIPTION_ID: "envsubscriptionid"
            AZURE_CLIENT_ID: "envclientid"
            AZURE_CLIENT_SECRET: "envclientsecret"
        register: credentials

      - debug: var=credentials['credentials']      
        when: debug_playbook == True

      - stat: path=~/.ansible/credentials
        register: file_stats 

      - name: create ~/.azure directory
        file:
            dest: ~/.auzre
            mode: 0600
            state: directory
        when: file_stats.stat.exists == False

      - name: create credential file with default section
        ini_file:
            dest: "~/.azure/credentials" 
            section: default
            option: subscription_id
            value: default_subscription
        when: file_stats.stat.exists == False
            
      - name: add client_id 
        ini_file:
            dest: ~/.azure/credentials 
            section: default 
            option: client_id 
            value: default_client_id
        when: file_stats.stat.exists == False

      - name: add client_secret 
        ini_file:
            dest: ~/.azure/credentials 
            section: default 
            option: client_secret
            value: default_seret
        when: file_stats.stat.exists == False

      - name: add test_one section 
        ini_file:
            dest: ~/.azure/credentials 
            section: test_one 
            option: subscription_id
            value: test_one_subscription 

      - name: add client_id 
        ini_file:
            dest: ~/.azure/credentials 
            section: test_one 
            option: client_id 
            value: test_one_client_id

      - name: add client_secret 
        ini_file:
            dest: ~/.azure/credentials 
            section: test_one 
            option: client_secret
            value: test_one_client_secret 

      - name: get test_one credentials from file  
        azure_rm_securitygroup:
             profile: test_one 
        register: credentials

      - debug: var=credentials['credentials']      
        when: debug_playbook == True

      - name: get default credentials from file
        azure_rm_securitygroup:
        register: credentials

      - debug: var=credentials['credentials']      
        when: debug_playbook == True
